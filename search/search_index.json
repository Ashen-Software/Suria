{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Documentaci\u00f3n del Proyecto","text":"<p>Bienvenido a la documentaci\u00f3n t\u00e9cnica del proyecto. Aqu\u00ed encontrar\u00e1s orientaci\u00f3n sobre la arquitectura, la API y el esquema de la base de datos.</p>"},{"location":"#contenido","title":"Contenido","text":"<ul> <li>Arquitectura: Diagramas y decisiones de dise\u00f1o</li> <li>API: Documentaci\u00f3n de endpoints</li> <li>Base de datos: Esquemas y modelos</li> </ul>"},{"location":"#fuentes-de-datos","title":"Fuentes de datos","text":""},{"location":"#consolidacion-de-liquidacion-de-regalias-por-campo","title":"Consolidaci\u00f3n de liquidaci\u00f3n de regal\u00edas por campo","text":"<p>Informaci\u00f3n de liquidaci\u00f3n definitiva de regal\u00edas por campo de hidrocarburos desde el a\u00f1o 2010 hasta la fecha.</p> <ul> <li>Autor(es): Agencia Nacional de Hidrocarburos</li> <li>Ficha (datos abiertos): Consolidaci\u00f3n de liquidaci\u00f3n de regal\u00edas por campo (Socrata)</li> <li>API (Socrata): Socrata API \u2014 j7js-yk74</li> </ul>"},{"location":"#declaracion-de-produccion-de-gas","title":"Declaraci\u00f3n de producci\u00f3n de gas","text":"<p>Publicaci\u00f3n de la declaraci\u00f3n de producci\u00f3n realizada por productores y comercializadores de gas natural.</p> <ul> <li>Autor(es): Ministerio de Minas y Energ\u00eda</li> <li>Formato de datos: Soportes magn\u00e9ticos por periodo (mes-a\u00f1o), generalmente en XLSX</li> <li>Enlace: Gas natural \u2014 Ministerio de Minas y Energ\u00eda</li> </ul>"},{"location":"#proyeccion-de-demanda-del-gas-natural","title":"Proyecci\u00f3n de demanda del gas natural","text":"<p>Metodolog\u00eda basada en relaciones con variables macroecon\u00f3micas y desagregaci\u00f3n regional; incluye escenarios alto, medio y bajo.</p> <ul> <li>Autor(es): UPME</li> <li>Formato de datos: Anexos por proyecciones anuales (XLSX)</li> <li>Enlace: Proyecciones de demanda \u2014 UPME</li> </ul>"},{"location":"api/endpoints/","title":"Endpoints","text":""},{"location":"arquitectura/directorios/","title":"Directorios","text":""},{"location":"arquitectura/directorios/#proceso-etl","title":"Proceso ETL","text":"<pre><code>/Suria/\n\u2502\n\u251c\u2500\u2500 data/                        \u2190 ETL\n\u2502   \u251c\u2500\u2500 Dockerfile\n\u2502   \u251c\u2500\u2500 requirements.txt\n\u2502   \u251c\u2500\u2500 scheduler/\n\u2502   \u2502   \u251c\u2500\u2500 runner.py           \u2190 Ejecuta workflows desde cron\n\u2502   \u2502   \u2514\u2500\u2500 jobs.py\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 workflows/\n\u2502   \u2502   \u251c\u2500\u2500 check_updates/\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 run.py           \u2190 Detecta cambios\n\u2502   \u2502   \u251c\u2500\u2500 full_etl/\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 run.py           \u2190 Ejecuta descargas seg\u00fan fuente\n\u2502   \u2502   \u2514\u2500\u2500 sources_config.json  \u2190 Fuentes + metadatos\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 extraction/\n\u2502   \u2502   \u251c\u2500\u2500 scrapers/            \u2190 Playwright y scraping\n\u2502   \u2502   \u251c\u2500\u2500 api_clients/         \u2190 Cliente requests/API\n\u2502   \u2502   \u2514\u2500\u2500 common/              \u2190 Utils comunes (fechas, hash, etc.)\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 logging/\n\u2502   \u2502   \u251c\u2500\u2500 logs/                \u2190 Archivos persistentes\n\u2502   \u2502   \u2514\u2500\u2500 logger.py            \u2190 Config de logs\n\u2502   \u2502\n\u2502   \u2514\u2500\u2500 services/\n\u2502       \u2514\u2500\u2500 backend_client.py    \u2190 Comunicaci\u00f3n con API del backend\n</code></pre>"},{"location":"arquitectura/implementacion/","title":"Implementaci\u00f3n","text":""},{"location":"arquitectura/implementacion/#plan-de-implementacion-por-hitos","title":"Plan de Implementaci\u00f3n por Hitos","text":""},{"location":"arquitectura/implementacion/#hito-1-infraestructura-base","title":"Hito 1: Infraestructura Base","text":"<ul> <li> <p>Configuraci\u00f3n de repositorio y GitHub Actions</p> </li> <li> <p>Esquema de base de datos en Supabase</p> </li> <li> <p>Sistema de logging b\u00e1sico</p> </li> </ul>"},{"location":"arquitectura/implementacion/#hito-2-deteccion-de-cambios","title":"Hito 2: Detecci\u00f3n de Cambios","text":"<ul> <li> <p>Scrapers livianos para las 3 fuentes</p> </li> <li> <p>L\u00f3gica de comparaci\u00f3n y trigger</p> </li> <li> <p>Configuraci\u00f3n de alertas b\u00e1sicas</p> </li> </ul>"},{"location":"arquitectura/implementacion/#hito-3-etl-completo","title":"Hito 3: ETL Completo","text":"<ul> <li> <p>Contenedor Playwright + dependencias</p> </li> <li> <p>Pipelines de transformaci\u00f3n por fuente</p> </li> <li> <p>Mecanismos de carga y UPSERT</p> </li> </ul>"},{"location":"arquitectura/implementacion/#hito-4-dashboard","title":"Hito 4: Dashboard","text":"<ul> <li> <p>Aplicaci\u00f3n React base</p> </li> <li> <p>Visualizaciones principales</p> </li> <li> <p>Despliegue en DigitalOcean/Coolify</p> </li> </ul>"},{"location":"arquitectura/implementacion/#hito-5-monitorizacion-avanzada","title":"Hito 5: Monitorizaci\u00f3n Avanzada","text":"<ul> <li> <p>Dashboards de m\u00e9tricas ETL</p> </li> <li> <p>Alertas proactivas</p> </li> <li> <p>Documentaci\u00f3n operativa</p> </li> </ul>"},{"location":"arquitectura/overview/","title":"Overview","text":""},{"location":"arquitectura/overview/#arquitectura-detallada","title":"Arquitectura Detallada","text":""},{"location":"arquitectura/overview/#1-orquestacion-y-ejecucion-github-actions","title":"1. Orquestaci\u00f3n y Ejecuci\u00f3n (GitHub Actions)","text":""},{"location":"arquitectura/overview/#workflows-implementados","title":"Workflows Implementados","text":"<p>check-updates.yml\u00a0(Ejecuci\u00f3n Semanal/Mensual)</p> <ul> <li> <p>Trigger:\u00a0Cron programado / activaci\u00f3n manual</p> </li> <li> <p>Funci\u00f3n:\u00a0Verifica cambios en fuentes usando Requests + BeautifulSoup</p> </li> <li> <p>Salida:\u00a0Dispara ETL completo solo si detecta cambios</p> </li> <li> <p>Costo:\u00a0M\u00ednimo (ejecuci\u00f3n r\u00e1pida sin contenedores)</p> </li> </ul> <p>full-etl.yml\u00a0(Completo - Solo cuando hay cambios)</p> <ul> <li> <p>Trigger:\u00a0Desde check-updates o manual</p> </li> <li> <p>Contenedor:\u00a0Playwright + Python para extracci\u00f3n robusta</p> </li> <li> <p>Proceso:\u00a0Extracci\u00f3n \u2192 Transformaci\u00f3n \u2192 Carga</p> </li> <li> <p>Costo:\u00a0Solo cuando es necesario (2-3 meses)</p> </li> </ul>"},{"location":"arquitectura/overview/#2-sistema-de-logs-y-monitorizacion","title":"2. Sistema de Logs y Monitorizaci\u00f3n","text":""},{"location":"arquitectura/overview/#estrategia-de-logs-multi-nivel","title":"Estrategia de Logs Multi-nivel","text":"<p>Nivel 1: Logs Estructurados en GitHub Actions</p> <ul> <li> <p>Logs nativos de ejecuci\u00f3n de workflows</p> </li> <li> <p>Captura de stdout/stderr de todos los scripts</p> </li> <li> <p>Retenci\u00f3n autom\u00e1tica seg\u00fan pol\u00edtica de GitHub</p> </li> </ul> <p>Nivel 2: M\u00e9tricas de Performance</p> <ul> <li> <p>Tiempos de ejecuci\u00f3n por fuente</p> </li> <li> <p>Volumen de datos procesados</p> </li> <li> <p>Tasa de \u00e9xito/error por componente</p> </li> </ul>"},{"location":"arquitectura/overview/#sistema-de-alertas-multi-canal","title":"Sistema de Alertas Multi-canal","text":"<p>1. GitHub Native Integrations</p> <ul> <li> <p>Notificaciones email nativas sobre fallos de workflows</p> </li> <li> <p>Configuraci\u00f3n directa en repository settings</p> </li> </ul> <p>2. Custom Email Service</p> <ul> <li>Notificaciones para stakeholders no t\u00e9cnicos (SMTP gratuito)</li> </ul>"},{"location":"arquitectura/overview/#3-procesamiento-de-datos-etl","title":"3. Procesamiento de Datos (ETL)","text":""},{"location":"arquitectura/overview/#tecnologias-clave","title":"Tecnolog\u00edas Clave","text":"<ul> <li> <p>Python 3.12+: Lenguaje principal</p> </li> <li> <p>Playwright: Extracci\u00f3n robusta en sitios complejos</p> </li> <li> <p>Pandas: Transformaci\u00f3n y limpieza de datos</p> </li> <li> <p>BeautifulSoup: Scraping liviano para detecci\u00f3n</p> </li> <li> <p>Supabase Python Client: Carga eficiente</p> </li> </ul>"},{"location":"arquitectura/overview/#estrategia-de-procesamiento","title":"Estrategia de Procesamiento","text":"<ol> <li> <p>Extracci\u00f3n Resiliente: Reintentos autom\u00e1ticos con backoff</p> </li> <li> <p>Validaci\u00f3n en Tiempo Real: Schemas, rangos, consistencia</p> </li> <li> <p>Procesamiento Incremental: Solo datos nuevos/cambiados</p> </li> <li> <p>Idempotencia: UPSERTs para evitar duplicados</p> </li> </ol>"},{"location":"arquitectura/overview/#4-almacenamiento-y-backend-supabase","title":"4. Almacenamiento y Backend (Supabase)","text":""},{"location":"arquitectura/overview/#esquema-de-base-de-datos","title":"Esquema de Base de Datos","text":"<p>POR DEFINIR</p>"},{"location":"arquitectura/overview/#optimizaciones-para-dashboard","title":"Optimizaciones para Dashboard","text":"<ul> <li> <p>Vistas materializadas para consultas frecuentes</p> </li> <li> <p>\u00cdndices en campos de filtro com\u00fan (fecha, entidad, territorio)</p> </li> <li> <p>Pol\u00edticas RLS para seguridad de datos</p> </li> </ul>"},{"location":"arquitectura/overview/#5-frontend-y-despliegue","title":"5. Frontend y Despliegue","text":""},{"location":"arquitectura/overview/#stack-tecnologico","title":"Stack Tecnol\u00f3gico","text":"<ul> <li> <p>Angular 16+: Framework principal</p> </li> <li> <p>Tailwind CSS: Estilizaci\u00f3n y responsive design</p> </li> <li> <p>Supabase JS Client: Conexi\u00f3n directa a datos</p> </li> <li> <p>Chart.js/NGX-Charts: Visualizaciones de datos</p> </li> </ul>"},{"location":"arquitectura/overview/#estrategia-de-despliegue","title":"Estrategia de Despliegue","text":"<ul> <li> <p>Vercel/Netlify: Despliegue continuo desde main branch</p> </li> <li> <p>Variables de Entorno: Configuraci\u00f3n segura de endpoints</p> </li> <li> <p>CDN Global: Distribuci\u00f3n optimizada de assets</p> </li> </ul> <p></p>"},{"location":"database/esquema/","title":"Esquema de Base de Datos","text":"<p>Este documento detalla la estructura de la base de datos en Supabase (PostgreSQL) utilizada para orquestar el ETL.</p>"},{"location":"database/esquema/#diagrama-relacional-simplificado","title":"Diagrama Relacional Simplificado","text":"<p><code>etl_sources (1) &lt;---&gt; (N) source_check_history</code></p>"},{"location":"database/esquema/#tablas","title":"Tablas","text":""},{"location":"database/esquema/#1-etl_sources","title":"1. <code>etl_sources</code>","text":"<p>Almacena la configuraci\u00f3n maestra de cada fuente de datos. Es la fuente de verdad para el Scheduler.</p> Columna Tipo Descripci\u00f3n <code>id</code> <code>text</code> PK. Identificador \u00fanico (ej: <code>min_minas_gas</code>, <code>precios_bolsa</code>). <code>name</code> <code>text</code> Nombre legible para humanos. <code>active</code> <code>boolean</code> Interruptor general. Si es <code>false</code>, el scheduler ignora esta fuente. <code>type</code> <code>text</code> Define el checker a usar: <code>api</code>, <code>scrape</code>, <code>complex_scraper</code>. <code>schedule_cron</code> <code>text</code> Expresi\u00f3n CRON para la frecuencia de chequeo (ej: <code>0 8 * * *</code>). <code>config</code> <code>jsonb</code> Par\u00e1metros espec\u00edficos del checker (URL, headers, selectores CSS). <code>storage_config</code> <code>jsonb</code> Configuraci\u00f3n de d\u00f3nde guardar los datos RAW (rutas, buckets). <code>created_at</code> <code>timestamptz</code> Fecha de creaci\u00f3n. <code>updated_at</code> <code>timestamptz</code> Fecha de \u00faltima modificaci\u00f3n de la config."},{"location":"database/esquema/#2-source_check_history","title":"2. <code>source_check_history</code>","text":"<p>Bit\u00e1cora inmutable de cada ejecuci\u00f3n del proceso <code>check-updates</code>. Permite auditar la salud de las fuentes y detectar cu\u00e1ndo hubo cambios reales.</p> Columna Tipo Descripci\u00f3n <code>id</code> <code>bigint</code> PK. Autoincremental. <code>source_id</code> <code>text</code> FK. Referencia a <code>etl_sources.id</code>. <code>status</code> <code>enum</code> Estado del chequeo: <code>no_change</code>, <code>changed</code>, <code>failed</code>. <code>checksum</code> <code>text</code> Hash MD5 del contenido detectado (para comparar cambios). <code>metadata</code> <code>jsonb</code> Datos variables de la ejecuci\u00f3n (URL consultada, notas de error, m\u00e9todo usado). <code>created_at</code> <code>timestamptz</code> Fecha y hora exacta de la ejecuci\u00f3n."},{"location":"database/esquema/#tipos-enumerados-enums","title":"Tipos Enumerados (ENUMs)","text":"<ul> <li><code>source_update_method</code>: <code>'api'</code>, <code>'scraping'</code>, <code>'html'</code>, <code>'archivo'</code>, <code>'complex_scraper'</code></li> <li><code>source_check_status</code>: <code>'no_change'</code>, <code>'changed'</code>, <code>'failed'</code></li> </ul>"},{"location":"database/esquema/#migracion-script","title":"Migracion script","text":"<p>El script .sql para crear la base de datos se encuentra en: script migraci\u00f3n.</p>"},{"location":"guias/api_configuracion/","title":"Configuraci\u00f3n de APIs","text":"<p>El sistema soporta m\u00faltiples m\u00e9todos de autenticaci\u00f3n y optimizaciones para consultas a APIs.</p>"},{"location":"guias/api_configuracion/#variables-de-entorno","title":"Variables de Entorno","text":"<p>Cualquier valor en <code>params</code> o <code>headers</code> que comience con <code>$</code> es tratado como una variable de entorno. Esto permite mantener las credenciales seguras sin exponerlas en el c\u00f3digo.</p> <p>Sintaxis: <pre><code>\"$VARIABLE_NAME\"  \u2192 se resuelve como os.getenv(\"VARIABLE_NAME\")\n</code></pre></p> <p>Ejemplo: <pre><code>{\n  \"id\": \"api_regalias\",\n  \"type\": \"api\",\n  \"config\": {\n    \"base_url\": \"https://www.datos.gov.co/api/v3/views/j7js-yk74/query.json\",\n    \"params\": {\n      \"app_token\": \"$DATOS_GOV_TOKEN\"\n    },\n    \"headers\": {\n      \"Accept\": \"application/json\"\n    }\n  }\n}\n</code></pre></p> <p>En el archivo <code>.env</code>: <pre><code>DATOS_GOV_TOKEN=tu_token_aqui\n</code></pre></p>"},{"location":"guias/api_configuracion/#tipos-de-autenticacion","title":"Tipos de Autenticaci\u00f3n","text":"<p>El par\u00e1metro <code>auth_type</code> en <code>config</code> especifica el m\u00e9todo de autenticaci\u00f3n. La credencial se define mediante <code>auth_key_env</code> (nombre de la variable de entorno).</p> auth_type Descripci\u00f3n Ejemplo <code>bearer</code> Agrega header <code>Authorization: Bearer {token}</code> OAuth 2.0, APIs modernas <code>api_key</code> Agrega header <code>X-API-Key: {token}</code> APIs que usan API Keys <code>custom_header</code> Permite especificar el nombre del header Cualquier header personalizado <p>Ejemplo con Bearer Token: <pre><code>{\n  \"id\": \"api_ejemplo\",\n  \"type\": \"api\",\n  \"config\": {\n    \"base_url\": \"https://api.ejemplo.com/data\",\n    \"auth_type\": \"bearer\",\n    \"auth_key_env\": \"API_EJEMPLO_TOKEN\",\n    \"headers\": { \"Accept\": \"application/json\" }\n  }\n}\n</code></pre></p> <p>En <code>.env</code>: <pre><code>API_EJEMPLO_TOKEN=sk_live_xxxxx\n</code></pre></p>"},{"location":"guias/api_configuracion/#deteccion-eficiente-de-cambios-apis-socrata","title":"Detecci\u00f3n Eficiente de Cambios (APIs Socrata)","text":"<p>Para APIs que retornan grandes vol\u00famenes de datos (ej. 200K+ registros), es ineficiente descargar todo para detectar cambios. Socrata y plataformas similares exponen un endpoint de metadata mucho m\u00e1s ligero.</p>"},{"location":"guias/api_configuracion/#parametros-especiales","title":"Par\u00e1metros especiales","text":"Par\u00e1metro Descripci\u00f3n Ejemplo <code>check_endpoint</code> Endpoint de metadata (sin datos) <code>https://datos.gov.co/api/views/{id}.json</code> <code>check_field</code> Campo en la metadata que indica cambios <code>rowsUpdatedAt</code>, <code>lastUpdateTime</code>"},{"location":"guias/api_configuracion/#flujo-optimizado","title":"Flujo optimizado","text":"<ol> <li>Check \u2192 Consulta solo metadata (~5KB)</li> <li>Compara el campo <code>check_field</code> con la ejecuci\u00f3n anterior</li> <li>Si cambi\u00f3 \u2192 Ejecuta Full ETL y descarga los datos</li> <li>Si no cambi\u00f3 \u2192 Omite la descarga (ahorro de ancho de banda)</li> </ol>"},{"location":"guias/api_configuracion/#ejemplo-de-configuracion","title":"Ejemplo de Configuraci\u00f3n","text":"<pre><code>{\n  \"id\": \"api_regalias\",\n  \"type\": \"api\",\n  \"config\": {\n    \"base_url\": \"https://www.datos.gov.co/api/v3/views/j7js-yk74/query.json\",\n    \"check_endpoint\": \"https://www.datos.gov.co/api/views/j7js-yk74.json\",\n    \"check_field\": \"rowsUpdatedAt\",\n    \"params\": {\n      \"app_token\": \"$DATOS_GOV_TOKEN\"\n    },\n    \"headers\": {\n      \"Accept\": \"application/json\"\n    }\n  }\n}\n</code></pre>"},{"location":"guias/api_configuracion/#configuracion-avanzada","title":"Configuraci\u00f3n Avanzada","text":"Par\u00e1metro Descripci\u00f3n Valor por defecto <code>timeout</code> Tiempo m\u00e1ximo de respuesta en segundos <code>60</code> <code>max_retries</code> N\u00famero de reintentos ante fallos <code>3</code> <p>Ejemplo: <pre><code>{\n  \"config\": {\n    \"base_url\": \"https://api.ejemplo.com/data\",\n    \"timeout\": 30,\n    \"max_retries\": 5,\n    \"auth_type\": \"bearer\",\n    \"auth_key_env\": \"API_TOKEN\"\n  }\n}\n</code></pre></p>"},{"location":"guias/configuracion_fuentes/","title":"Gu\u00eda de Configuraci\u00f3n de Fuentes","text":"<p>Esta gu\u00eda proporciona una introducci\u00f3n a c\u00f3mo configurar diferentes tipos de fuentes de datos en el sistema ETL.</p>"},{"location":"guias/configuracion_fuentes/#tipos-de-fuentes-soportadas","title":"Tipos de Fuentes Soportadas","text":"Tipo Descripci\u00f3n Complejidad Ejemplo <code>api</code> Consume datos directamente de una API REST Baja API de datos p\u00fablicos, Socrata <code>web</code> Descarga HTML de un sitio web Baja Web scraping b\u00e1sico <code>complex_scraper</code> L\u00f3gica personalizada con Selenium/Playwright Alta Navegaci\u00f3n interactiva, JS renderizado"},{"location":"guias/configuracion_fuentes/#guias-especificas","title":"Gu\u00edas Espec\u00edficas","text":"<p>Para detalles completos sobre cada tipo de configuraci\u00f3n, consulta:</p> <ul> <li>Configuraci\u00f3n de Storage - D\u00f3nde se guardan los datos</li> <li>Configuraci\u00f3n de APIs - C\u00f3mo consumir APIs REST</li> <li>Scripts Personalizados - Implementar l\u00f3gica compleja</li> </ul>"},{"location":"guias/configuracion_fuentes/#estructura-basica-de-una-fuente","title":"Estructura B\u00e1sica de una Fuente","text":"<pre><code>{\n  \"id\": \"mi_fuente\",\n  \"name\": \"Mi Fuente de Datos\",\n  \"active\": true,\n  \"type\": \"api\",\n  \"schedule\": { \"cron\": \"0 9 * * *\", \"note\": \"Daily at 9 AM\" },\n  \"config\": {\n    // Configuraci\u00f3n espec\u00edfica del tipo\n  },\n  \"storage\": {\n    \"bucket\": \"raw-data\"\n  }\n}\n</code></pre>"},{"location":"guias/configuracion_fuentes/#parametros-comunes","title":"Par\u00e1metros Comunes","text":"Par\u00e1metro Descripci\u00f3n Requerido <code>id</code> Identificador \u00fanico de la fuente S\u00ed <code>name</code> Nombre descriptivo No <code>active</code> Si debe ejecutarse S\u00ed <code>type</code> Tipo de fuente: <code>api</code>, <code>web</code>, <code>complex_scraper</code> S\u00ed <code>schedule</code> Cron de ejecuci\u00f3n S\u00ed <code>config</code> Configuraci\u00f3n espec\u00edfica del tipo S\u00ed <code>storage</code> D\u00f3nde guardar los datos S\u00ed"},{"location":"guias/configuracion_fuentes/#formatos-de-schedule-cron","title":"Formatos de Schedule (cron)","text":"<pre><code>\"schedule\": { \n  \"cron\": \"0 9 * * *\",\n  \"note\": \"Daily at 9 AM\"\n}\n</code></pre> <p>Ejemplos comunes: - <code>\"* * * * *\"</code> - Cada minuto - <code>\"0 * * * *\"</code> - Cada hora - <code>\"0 9 * * *\"</code> - Cada d\u00eda a las 9 AM - <code>\"0 0 * * 1\"</code> - Cada lunes a medianoche - <code>\"*/30 * * * *\"</code> - Cada 30 minutos</p>"},{"location":"guias/configuracion_fuentes/#flujo-de-ejecucion","title":"Flujo de Ejecuci\u00f3n","text":""},{"location":"guias/configuracion_fuentes/#1-scheduler","title":"1. Scheduler","text":"<p>El APScheduler ejecuta seg\u00fan el cron definido.</p>"},{"location":"guias/configuracion_fuentes/#2-check-updates-deteccion-de-cambios","title":"2. Check Updates (Detecci\u00f3n de Cambios)","text":"<ul> <li>Resuelve variables de entorno</li> <li>Consulta estado actual (metadata o datos)</li> <li>Calcula hash SHA256</li> <li>Compara con \u00faltima ejecuci\u00f3n</li> </ul>"},{"location":"guias/configuracion_fuentes/#3-decision","title":"3. Decisi\u00f3n","text":"<ul> <li>Cambios detectados \u2192 Ejecuta Full ETL</li> <li>Sin cambios \u2192 Omite descarga</li> </ul>"},{"location":"guias/configuracion_fuentes/#4-full-etl-si-hay-cambios","title":"4. Full ETL (Si hay cambios)","text":"<ul> <li>Resuelve variables de entorno</li> <li>Descarga/procesa datos</li> <li>Genera ruta con timestamp</li> <li>Sube archivo a Supabase Storage</li> </ul>"},{"location":"guias/configuracion_fuentes/#5-registro-en-base-de-datos","title":"5. Registro en Base de Datos","text":"<ul> <li><code>etl_sources</code>: estado y \u00faltima verificaci\u00f3n</li> <li><code>source_check_history</code>: historial de cada ejecuci\u00f3n</li> </ul>"},{"location":"guias/configuracion_fuentes/#mejores-practicas","title":"Mejores Pr\u00e1cticas","text":"<ul> <li>Mant\u00e9n credenciales en <code>.env</code>, nunca en config</li> <li>Usa <code>$VARIABLE</code> para referencias a variables de entorno</li> <li>Aprovecha <code>check_endpoint</code> para APIs grandes (reduce transferencia)</li> <li>Define schedules apropiados (no sobrecargar servicios)</li> <li>Registra cambios en Git, no datos descargados</li> <li>Nunca commitees <code>.env</code> con credenciales reales</li> </ul>"},{"location":"guias/configuracion_fuentes/#ejemplos-completos","title":"Ejemplos Completos","text":""},{"location":"guias/configuracion_fuentes/#ejemplo-1-api-simple","title":"Ejemplo 1: API Simple","text":"<pre><code>{\n  \"id\": \"api_gas\",\n  \"name\": \"API Gas Colombia\",\n  \"active\": true,\n  \"type\": \"api\",\n  \"schedule\": { \"cron\": \"0 * * * *\" },\n  \"config\": {\n    \"base_url\": \"https://httpbin.org/json\"\n  },\n  \"storage\": { \"bucket\": \"raw-data\" }\n}\n</code></pre>"},{"location":"guias/configuracion_fuentes/#ejemplo-2-api-con-autenticacion","title":"Ejemplo 2: API con Autenticaci\u00f3n","text":"<pre><code>{\n  \"id\": \"api_regalias\",\n  \"name\": \"Consolidaci\u00f3n de regalias\",\n  \"active\": true,\n  \"type\": \"api\",\n  \"schedule\": { \"cron\": \"0 9 * * *\" },\n  \"config\": {\n    \"base_url\": \"https://www.datos.gov.co/api/v3/views/j7js-yk74/query.json\",\n    \"check_endpoint\": \"https://www.datos.gov.co/api/views/j7js-yk74.json\",\n    \"check_field\": \"rowsUpdatedAt\",\n    \"params\": { \"app_token\": \"$DATOS_GOV_TOKEN\" },\n    \"headers\": { \"Accept\": \"application/json\" }\n  },\n  \"storage\": { \"bucket\": \"raw-data\" }\n}\n</code></pre>"},{"location":"guias/configuracion_fuentes/#ejemplo-3-web-scraping","title":"Ejemplo 3: Web Scraping","text":"<pre><code>{\n  \"id\": \"scrape_example\",\n  \"name\": \"Scrape Example\",\n  \"active\": true,\n  \"type\": \"web\",\n  \"schedule\": { \"cron\": \"0 12 * * *\" },\n  \"config\": { \"url\": \"https://example.com\" },\n  \"storage\": { \"bucket\": \"raw-data\" }\n}\n</code></pre>"},{"location":"guias/configuracion_fuentes/#ejemplo-4-script-personalizado","title":"Ejemplo 4: Script Personalizado","text":"<pre><code>{\n  \"id\": \"banco_central\",\n  \"name\": \"Banco Central Bot\",\n  \"active\": true,\n  \"type\": \"complex_scraper\",\n  \"schedule\": { \"cron\": \"0 9 * * *\" },\n  \"config\": { \"script_name\": \"bot_banco_central\" },\n  \"storage\": { \"bucket\": \"raw-data\" }\n}\n</code></pre>"},{"location":"guias/configuracion_fuentes/#archivos-de-referencia","title":"Archivos de Referencia","text":"<ul> <li><code>data/workflows/sources_config.json</code> - Configuraci\u00f3n de ejemplo</li> <li><code>data/extraction/scrapers/</code> - Ubicaci\u00f3n de scripts personalizados</li> <li><code>docs/database/esquema.md</code> - Esquema de base de datos</li> </ul>"},{"location":"guias/scripts_personalizados/","title":"Configuraci\u00f3n de Scripts Personalizados","text":"<p>Para fuentes que requieren l\u00f3gica de extracci\u00f3n compleja (Selenium, Playwright, pasos m\u00faltiples), se utiliza el tipo <code>complex_scraper</code>.</p>"},{"location":"guias/scripts_personalizados/#vinculacion-del-script","title":"Vinculaci\u00f3n del Script","text":"<p>El sistema busca un script de Python en la carpeta <code>data/extraction/scrapers/</code>. Por defecto, busca un archivo con el mismo nombre que el <code>id</code> de la fuente.</p> <p>Para usar un nombre de archivo diferente, se utiliza el par\u00e1metro <code>script_name</code> dentro de <code>config</code>.</p>"},{"location":"guias/scripts_personalizados/#ejemplo-basico","title":"Ejemplo B\u00e1sico","text":"<pre><code>{\n  \"id\": \"banco_central_trm\",\n  \"type\": \"complex_scraper\",\n  \"schedule\": { \"cron\": \"0 9 * * *\" },\n  \"config\": {\n    \"script_name\": \"bot_banco_central\"\n  },\n  \"storage\": {\n    \"bucket\": \"raw-data\"\n  }\n}\n</code></pre> <p>En este ejemplo: - El sistema buscar\u00e1 <code>data/extraction/scrapers/bot_banco_central.py</code> - Ejecutar\u00e1 la funci\u00f3n <code>check(config)</code> durante la detecci\u00f3n de cambios - Ejecutar\u00e1 la funci\u00f3n <code>extract(config)</code> durante la descarga</p>"},{"location":"guias/scripts_personalizados/#estructura-del-script-personalizado","title":"Estructura del Script Personalizado","text":"<p>El script debe implementar dos funciones:</p>"},{"location":"guias/scripts_personalizados/#funcion-checkconfig","title":"Funci\u00f3n <code>check(config)</code>","text":"<p>Realiza la detecci\u00f3n de cambios. Debe retornar un valor hasheable (string, n\u00famero, etc).</p> <pre><code>def check(source_config: Dict[str, Any]) -&gt; str:\n    \"\"\"\n    Detecta cambios en la fuente.\n    Retorna un valor que ser\u00e1 hasheado para comparar con ejecuciones anteriores.\n\n    Ejemplos:\n    - Timestamp del \u00faltimo cambio\n    - Hash de contenido visible\n    - N\u00famero de elementos en la p\u00e1gina\n    \"\"\"\n    # Usar Selenium/Playwright para obtener informaci\u00f3n\n    # ...\n    return f\"estado_actual_{timestamp}\"\n</code></pre>"},{"location":"guias/scripts_personalizados/#funcion-extractconfig","title":"Funci\u00f3n <code>extract(config)</code>","text":"<p>Realiza la extracci\u00f3n de datos. Debe retornar bytes o string con el contenido.</p> <pre><code>def extract(source_config: Dict[str, Any]) -&gt; bytes:\n    \"\"\"\n    Descarga y procesa los datos.\n    Retorna el contenido a guardar en Storage.\n    \"\"\"\n    # Usar Selenium/Playwright para descargar/procesar datos\n    # ...\n    return contenido_procesado.encode('utf-8')\n</code></pre>"},{"location":"guias/scripts_personalizados/#ejemplo-real-bot-del-banco-central","title":"Ejemplo Real: Bot del Banco Central","text":"<pre><code># data/extraction/scrapers/bot_banco_central.py\n\nfrom typing import Dict, Any\nfrom datetime import datetime\nfrom selenium import webdriver\nfrom selenium.webdriver.common.by import By\n\ndef check(source_config: Dict[str, Any]) -&gt; str:\n    \"\"\"Detecta si hubo cambios en la tasa representativa del mercado.\"\"\"\n    driver = webdriver.Chrome()\n    try:\n        driver.get(\"https://www.bancocentral.gov.co/tasas\")\n\n        # Extrae el timestamp de \u00faltima actualizaci\u00f3n\n        update_element = driver.find_element(By.CLASS_NAME, \"last-update\")\n        last_update = update_element.text\n\n        return last_update\n    finally:\n        driver.quit()\n\ndef extract(source_config: Dict[str, Any]) -&gt; bytes:\n    \"\"\"Descarga la tasa actual.\"\"\"\n    driver = webdriver.Chrome()\n    try:\n        driver.get(\"https://www.bancocentral.gov.co/tasas\")\n\n        # Espera a que cargue la tasa\n        rate_element = driver.find_element(By.ID, \"current-rate\")\n        rate = rate_element.text\n\n        # Procesa y retorna\n        data = f\"TRM: {rate} - {datetime.now().isoformat()}\"\n        return data.encode('utf-8')\n    finally:\n        driver.quit()\n</code></pre>"},{"location":"guias/scripts_personalizados/#variables-de-entorno-en-scripts","title":"Variables de Entorno en Scripts","text":"<p>Tambi\u00e9n puedes usar variables de entorno dentro de scripts personalizados:</p> <pre><code>import os\nfrom common.env_resolver import resolve_env_var\n\ndef check(source_config: Dict[str, Any]) -&gt; str:\n    # Resuelve variable de entorno\n    api_token = resolve_env_var(\"$MY_SECRET_TOKEN\")\n\n    # O acceso directo\n    api_token = os.getenv(\"MY_SECRET_TOKEN\")\n\n    # ... resto del c\u00f3digo\n</code></pre>"},{"location":"guias/scripts_personalizados/#recomendaciones","title":"Recomendaciones","text":"<ul> <li>Usa try/finally para cerrar drivers (Selenium/Playwright)</li> <li>Implementa timeouts en las b\u00fasquedas de elementos</li> <li>Registra errores con el logger</li> </ul>"},{"location":"guias/scripts_personalizados/#depuracion-local","title":"Depuraci\u00f3n Local","text":"<p>Para probar tu script sin el scheduler:</p> <pre><code># test_bot_banco_central.py\nfrom extraction.scrapers.bot_banco_central import check, extract\n\nconfig = {\n    \"id\": \"banco_central_trm\",\n    \"config\": {}\n}\n\n# Prueba check\nprint(\"Check:\", check(config))\n\n# Prueba extract\nprint(\"Extract:\", extract(config))\n</code></pre>"},{"location":"guias/storage_configuracion/","title":"Configuraci\u00f3n de Storage","text":"<p>El sistema utiliza Supabase Storage para almacenar la data cruda (RAW) extra\u00edda de las diferentes fuentes.</p>"},{"location":"guias/storage_configuracion/#creacion-del-bucket","title":"Creaci\u00f3n del Bucket","text":"<p>Para que el sistema funcione correctamente, se debe crear un bucket en el proyecto de Supabase con las siguientes caracter\u00edsticas:</p> <ul> <li>Nombre del Bucket: <code>raw-data</code></li> <li>Acceso: Privado (recomendado) o P\u00fablico.</li> </ul>"},{"location":"guias/storage_configuracion/#estructura-de-archivos","title":"Estructura de Archivos","text":"<p>El sistema organiza autom\u00e1ticamente los archivos descargados para mantener un historial ordenado cronol\u00f3gicamente. La estructura de carpetas generada por defecto es:</p> <pre><code>{tipo_fuente}/{id_fuente}/{YYYY-MM-DD_HHMMSS}.{ext}\n</code></pre> <p>Ejemplos: *   <code>api/api_gas/2023-11-24_103000.json</code> *   <code>web/noticias_col/2023-11-24_154500.html</code> *   <code>complex/banco_central/2023-11-24_090000.bin</code></p> <p>Esta estructura plana facilita la gesti\u00f3n de historiales cortos (ej. \u00faltimos 2-3 meses).</p>"},{"location":"guias/storage_configuracion/#configuracion-basica","title":"Configuraci\u00f3n B\u00e1sica","text":"<p>Solo es necesario especificar el nombre del bucket. El sistema se encarga de generar la ruta y el nombre del archivo.</p> <pre><code>{\n  \"id\": \"mi_fuente\",\n  \"type\": \"api\",\n  \"storage\": {\n    \"bucket\": \"raw-data\"\n  }\n}\n</code></pre>"},{"location":"guias/storage_configuracion/#parametros-disponibles","title":"Par\u00e1metros Disponibles","text":"Par\u00e1metro Descripci\u00f3n Valor por defecto <code>bucket</code> Nombre del bucket en Supabase. <code>\"raw-data\"</code> <code>path</code> (Opcional) Ruta completa del archivo. Si se define, sobrescribe la generaci\u00f3n autom\u00e1tica de historial. \u00datil si solo se desea mantener la \u00faltima versi\u00f3n. <code>None</code> (Autom\u00e1tico) <p>Nota: Para historiales, es recomendable omitir <code>path</code> y dejar que el sistema genere la ruta con timestamp autom\u00e1ticamente.</p>"}]}